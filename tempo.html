<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tempo ‚Äì EB de Manhente</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:#f1f5f9;
  color:#1f2933;
}

header{
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:white;
  padding:25px 20px;
}

.header-content{
  max-width:900px;
  margin:auto;
  display:flex;
  align-items:center;
  gap:20px;
}

.header-content img{
  width:80px;
  background:white;
  border-radius:50%;
  padding:6px;
}

main{
  max-width:900px;
  margin:40px auto;
  padding:0 20px;
}

#cartao-clima{
  background:linear-gradient(135deg,#3b82f6,#2563eb);
  color:white;
  border-radius:20px;
  padding:30px;
  text-align:center;
  box-shadow:0 12px 30px rgba(0,0,0,.2);
}

/* TEMP + √çCONE */
#linha-temp{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:14px;
}

#icone-atual{
  font-size:2.2em;
  line-height:1;
}

#temp{
  font-size:3.2em;
  font-weight:700;
}

#dados,#hora,#fonte{
  margin-top:8px;
}

#acessos{
  margin-top:30px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}

.card{
  padding:18px;
  border-radius:14px;
  color:white;
  text-decoration:none;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
  transition:.2s;
}

.card:hover{transform:translateY(-4px);}

.wu{background:linear-gradient(135deg,#f59e0b,#d97706);}
.wc{background:linear-gradient(135deg,#38bdf8,#0284c7);}
.pwl{background:linear-gradient(135deg,#22c55e,#15803d);}

#previsao{
  margin-top:50px;
}

#indicadores{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:15px;
  margin-bottom:25px;
}

.indicador,.dia,.sensor{
  background:white;
  padding:15px;
  border-radius:12px;
  text-align:center;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}

#dias{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:15px;
}

.icone{
  font-size:2em;
  margin-bottom:6px;
}

#sensores{
  margin-top:50px;
}

#sensores-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
  gap:15px;
}

#legenda{
  margin-top:40px;
  padding:25px;
  background:white;
  border-radius:12px;
  text-align:center;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.logo-bora{
  max-width:180px;
  height:auto;
  margin:10px 0;
  transition:transform .2s, opacity .2s;
}

.logo-bora:hover{
  transform:scale(1.05);
  opacity:.9;
}

footer{
  margin:40px 0 20px;
  text-align:center;
  font-size:.8em;
  color:#6b7280;
}
</style>
</head>

<body>

<header>
  <div class="header-content">
    <img src="logo-eb-manhente.png" alt="EB de Manhente">
    <div>
      <h1>Tempo Meteorol√≥gico</h1>
      <p>
        <a href="index.html" style="color:white; text-decoration:underline;">
          EB de Manhente
        </a>
        ¬∑ Barcelos
      </p>
    </div>
  </div>
</header>

<main>

<div id="cartao-clima">
  <div id="linha-temp">
    <div id="icone-atual">‚õÖ</div>
    <div id="temp">A carregar‚Ä¶</div>
  </div>
  <div id="dados"></div>
  <div id="hora"></div>
  <div id="fonte"></div>
</div>

<div id="acessos">
  <a class="card wu" href="https://www.wunderground.com/weather/pt/manhente/IMANHE1" target="_blank">
    Weather Underground<br><small>Acesso livre</small>
  </a>
  <a class="card wc" href="https://app.weathercloud.net/d7620547198#current" target="_blank">
    WeatherCloud<br><small>Acesso livre</small>
  </a>
  <a class="card pwl" href="https://proweatherlive.net/dashboard?id=69397140b67eb10008cb6d87" target="_blank">
    ProWeatherLive<br><small>Acesso reservado</small>
  </a>
</div>

<div id="previsao">
  <h2>Previs√£o Meteorol√≥gica ‚Äì Manhente</h2>

  <div id="indicadores">
    <div class="indicador"><strong>Press√£o</strong><br><span id="pressao">‚Äî</span></div>
    <div class="indicador"><strong>√çndice UV</strong><br><span id="uv">‚Äî</span></div>
    <div class="indicador"><strong>Rajadas</strong><br><span id="rajadas">‚Äî</span></div>
  </div>

  <div id="dias"></div>
</div>

<div id="sensores">
  <h2>Sensores da Esta√ß√£o Local</h2>
  <div id="sensores-grid"></div>
</div>

<div id="legenda">
  Projeto da Associa√ß√£o<br>
  <a href="https://borambientar.pt/" target="_blank" rel="noopener noreferrer">
    <img src="logo-bora-ambientar.png" alt="BORA AMBIENTAR" class="logo-bora">
  </a>
  <br>
  e da <strong>EB de Manhente</strong>
</div>

</main>

<footer>
  P√°gina informativa com dados meteorol√≥gicos
</footer>

<script>
const apiKey="cc9cbc0aeacb47899cbc0aeacbc7891b";

// 1 casa decimal
function format1(n){
  return Number(n).toFixed(1);
}

// √çCONES (Open-Meteo weathercode)
function iconeTempo(code){
  if(code===0)return"‚òÄÔ∏è";
  if([1,2].includes(code))return"üå§Ô∏è";
  if(code===3)return"‚òÅÔ∏è";
  if([45,48].includes(code))return"üå´Ô∏è";
  if([51,53,55,61,63,65].includes(code))return"üåßÔ∏è";
  if([66,67].includes(code))return"üåßÔ∏è‚ùÑÔ∏è";
  if([71,73,75,77].includes(code))return"‚ùÑÔ∏è";
  if([80,81,82].includes(code))return"üå¶Ô∏è";
  if([95,96,99].includes(code))return"‚õàÔ∏è";
  return"üå°Ô∏è";
}

// SENSOR CARD
function sensor(nome, valor, unidade=""){
  if(valor===undefined || valor===null) return "";
  return `<div class="sensor"><strong>${nome}</strong><br>${valor}${unidade}</div>`;
}

// UI ATUAL
function atualizarAtual(temp, hum, vento, fonte, icone){
  document.getElementById("temp").innerText = format1(temp) + "¬∞C";
  document.getElementById("icone-atual").innerText = icone || "üå°Ô∏è";
  document.getElementById("dados").innerText =
    `Humidade: ${hum} ¬∑ Vento: ${format1(vento)} km/h`;
  document.getElementById("hora").innerText =
    "Atualizado: "+new Date().toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"});
  document.getElementById("fonte").innerText = "Fonte: " + fonte;
}

// Buscar √≠cone (estado do tempo) no Open-Meteo (s√≥ para o √≠cone)
let iconeAtual = "üå°Ô∏è";
const iconePromise = fetch("https://api.open-meteo.com/v1/forecast?latitude=41.5388&longitude=-8.6151&current_weather=true&timezone=Europe/Lisbon")
  .then(r=>r.json())
  .then(d=>{ iconeAtual = iconeTempo(d.current_weather.weathercode); })
  .catch(()=>{ iconeAtual = "üå°Ô∏è"; });

// WEATHER UNDERGROUND (esta√ß√£o local)
Promise.all([iconePromise]).then(()=>{
  return fetch(`https://api.weather.com/v2/pws/observations/current?stationId=IMANHE1&format=json&units=m&apiKey=${apiKey}`);
})
.then(r=>r.json())
.then(d=>{
  if(!d.observations) throw "offline";
  const o=d.observations[0];

  atualizarAtual(
    o.metric.temp,
    o.humidity+"%",
    o.metric.windSpeed,
    "Esta√ß√£o local",
    iconeAtual
  );

  document.getElementById("sensores-grid").innerHTML =
    sensor("Press√£o", o.metric.pressure, " hPa") +
    sensor("Sensa√ß√£o T√©rmica", format1(o.metric.heatIndex), " ¬∞C") +
    sensor("Ponto de Orvalho", format1(o.metric.dewpt), " ¬∞C") +
    sensor("Wind Chill", format1(o.metric.windChill), " ¬∞C") +
    sensor("√çndice UV", o.uv) +
    sensor("Radia√ß√£o Solar", o.solarRadiation, " W/m¬≤") +
    sensor("Visibilidade", o.metric.visibility, " km") +
    sensor("Chuva (hora)", o.metric.precipRate, " mm/h") +
    sensor("Chuva acumulada", o.metric.precipTotal, " mm");
})
.catch(()=>{
  // FALLBACK (Open-Meteo total)
  fetch("https://api.open-meteo.com/v1/forecast?latitude=41.5388&longitude=-8.6151&current_weather=true&timezone=Europe/Lisbon")
  .then(r=>r.json())
  .then(d=>{
    atualizarAtual(
      d.current_weather.temperature,
      "‚Äî",
      d.current_weather.windspeed,
      "Modelo meteorol√≥gico",
      iconeTempo(d.current_weather.weathercode)
    );
    // sensores ficam vazios no fallback
    document.getElementById("sensores-grid").innerHTML =
      `<div class="sensor"><strong>Sensores</strong><br>Indispon√≠veis (esta√ß√£o offline)</div>`;
  });
});

// PREVIS√ÉO
fetch("https://api.open-meteo.com/v1/forecast?latitude=41.5388&longitude=-8.6151&daily=temperature_2m_max,temperature_2m_min,uv_index_max,precipitation_probability_max,weathercode&current=surface_pressure,wind_gusts_10m&timezone=Europe/Lisbon")
.then(r=>r.json())
.then(d=>{
  document.getElementById("pressao").innerText=d.current.surface_pressure+" hPa";
  document.getElementById("uv").innerText=d.daily.uv_index_max[0];
  document.getElementById("rajadas").innerText=format1(d.current.wind_gusts_10m)+" km/h";

  const dias=document.getElementById("dias");
  dias.innerHTML="";
  d.daily.time.slice(0,5).forEach((dia,i)=>{
    dias.innerHTML+=`
      <div class="dia">
        <div class="icone">${iconeTempo(d.daily.weathercode[i])}</div>
        <strong>${new Date(dia).toLocaleDateString("pt-PT",{weekday:"short"})}</strong><br>
        M√°x: ${format1(d.daily.temperature_2m_max[i])}¬∞C<br>
        M√≠n: ${format1(d.daily.temperature_2m_min[i])}¬∞C<br>
        Chuva: ${d.daily.precipitation_probability_max[i]}%
      </div>`;
  });
});
</script>

</body>
</html>
